<html>
<head>
    <title>BlobConverter</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <style>
        pre {
            background-color: #dbdbdb;
            overflow: auto;
        }
    </style>
</head>
<body>
<form action="/" method="POST" enctype="multipart/form-data">
    <div>
        <h1>OpenVINO model to MyriadX blob converter</h1>
        <h3>Compiler version</h3>
        {% for line in version %}
        <p>{{line}}</p>
        {% endfor %}
    </div>
    <div>
        <label>
            Choose desired workflow:
            <select name="compile_type" onchange="showDesiredVersion(this)">
                <option value="myriad" selected="selected">Convert OpenVINO model</option>
                <option value="zoo">Use model from OpenVINO model zoo</option>
                <option value="model">Convert TensorFlow / Caffe model</option>
            </select>
        </label>
    </div>
    <p>==============================================</p>
    <div id="myriad">
        <div>
            <label for="definitons_file">Definition file (.xml)</label>
            <input type="file" name="definition" id="definitons_file">
        </div>
        <div>
            <label for="weights_file">Weights file (.bin)</label>
            <input type="file" name="weights" id="weights_file">
        </div>
    </div>
    <div id="model" style="display: none">
        <div>
            <input type="radio" id="caffe" name="model_type" value="caffe" checked="checked"
                   onclick="chooseCaffeModel()">
            <label for="caffe">Caffe</label>
            <input type="radio" id="tf" name="model_type" value="tf" onclick="chooseTFModel()">
            <label for="tf">TensorFlow</label>
        </div>
        <div>
            <label for="model_file" id="model_file_label_caffe">Model file (.caffemodel)</label>
            <label for="model_file" id="model_file_label_tf" style="display: none">Model file (.pb)</label>
            <input type="file" name="model" id="model_file">
        </div>
        <div id="proto_file_section">
            <label for="proto_file">Proto file (.prototxt)</label>
            <input type="file" name="proto" id="proto_file">
        </div>
    </div>
    <div id="zoo" style="display: none">
        <label>
            Choose model:
            <select name="model_name">
                <option value="" selected disabled hidden>Choose here</option>
                {% for model in zoo_models %}
                <option value="{{model}}">{{model}}</option>
                {% endfor %}
            </select>
        </label>
        <div>
            <label for="model_downloader_params">Intermediate compiler flags</label>
            <input type="text" style="width: 80%" value="--precisions FP16 --num_attempts 5"
                   name="model_downloader_params" id="model_downloader_params">
        </div>
    </div>
    <div id="intermediate_compiler" style="display: none">
        <label for="intermediate_compiler_params">Intermediate compiler flags</label>
        <input type="text" style="width: 80%"
               value="--data_type=FP16 --mean_values [127.5,127.5,127.5] --scale_values [255,255,255]"
               name="intermediate_compiler_params" id="intermediate_compiler_params">
    </div>
    <div>
        <label for="compiler_params">Compile flags</label>
        <input type="text" style="width: 90%"
               value="-ip U8 -VPU_MYRIAD_PLATFORM VPU_MYRIAD_2480 -VPU_NUMBER_OF_SHAVES 4 -VPU_NUMBER_OF_CMX_SLICES 4"
               name="compiler_params" id="compiler_params">
    </div>
    <input type="submit" value="Convert">
</form>
<div style="position: absolute; right: 20px; top: 20px">
    <button onclick="document.getElementById('api-modal').style.display='block'">API Integration</button>
</div>
<div id="api-modal" class="w3-modal">
    <div class="w3-modal-content">
        <div class="w3-container">
            <span onclick="document.getElementById('api-modal').style.display='none'"
                  class="w3-button w3-display-topright">&times;</span>
            <h1>API integration guide</h1>
            <h3>Convert OpenVINO model</h3>
            <pre><code>import requests

url = "{{url}}"  # change if running against other URL

payload = {
    'compiler_params': '-ip U8 -VPU_MYRIAD_PLATFORM VPU_MYRIAD_2480 -VPU_NUMBER_OF_SHAVES 4 -VPU_NUMBER_OF_CMX_SLICES 4',
    'compile_type': 'myriad'
}
files = [
    ('definition', open('/path/to/definition.xml', 'rb')),
    ('weights', open('/path/to/weights.bin', 'rb'))
]
headers = {
    'Content-Type': 'application/json'
}

response = requests.request("POST", url, headers=headers, data=payload, files=files)
</code></pre>
            <h3>Convert Caffe / TensorFlow model</h3>
            <pre><code>import requests

url = "{{url}}"  # change if running against other URL
payload = {
    'compile_type': 'model',
    'model_type': 'caffe',
    'intermediate_compiler_params': '--data_type=FP16 --mean_values [127.5,127.5,127.5] --scale_values [255,255,255]',
    'compiler_params': '-ip U8 -VPU_MYRIAD_PLATFORM VPU_MYRIAD_2480 -VPU_NUMBER_OF_SHAVES 4 -VPU_NUMBER_OF_CMX_SLICES 4'
}
files = [
    ('model', open('/path/to/mobilenet-ssd.caffemodel', 'rb')),
    ('proto', open('/path/to/mobilenet-ssd.prototxt', 'rb'))
]
headers = {
    'Content-Type': 'application/json'
}
response = requests.request("POST", url, headers=headers, data=payload, files=files)</code></pre>
            <h3>Download model from model zoo</h3>
            <pre><code>import requests

url = "{{url}}"  # change if running against other URL
payload = {
    'compile_type': 'zoo',
    'model_name': 'mobilenet-ssd',
    'model_downloader_params': '--precisions FP16 --num_attempts 5',
    'intermediate_compiler_params': '--data_type=FP16 --mean_values [127.5,127.5,127.5] --scale_values [255,255,255]',
    'compiler_params': '-ip U8 -VPU_MYRIAD_PLATFORM VPU_MYRIAD_2480 -VPU_NUMBER_OF_SHAVES 4 -VPU_NUMBER_OF_CMX_SLICES 4'
}
headers = {
    'Content-Type': 'application/json'
}
response = requests.request("POST", url, headers=headers, data=payload)</code></pre>
        </div>
    </div>
</div>
<script>
  function showDesiredVersion(selected) {
    switch (selected.value) {
      case 'myriad': {
        document.getElementById("myriad").style.display = "block";
        document.getElementById("intermediate_compiler").style.display = "none";
        document.getElementById("model").style.display = "none";
        document.getElementById("zoo").style.display = "none";
        break;
      }
      case 'zoo': {
        document.getElementById("myriad").style.display = "none";
        document.getElementById("intermediate_compiler").style.display = "block";
        document.getElementById("model").style.display = "none";
        document.getElementById("zoo").style.display = "block";
        break;
      }
      case 'model': {
        document.getElementById("myriad").style.display = "none";
        document.getElementById("intermediate_compiler").style.display = "block";
        document.getElementById("model").style.display = "block";
        document.getElementById("zoo").style.display = "none";
        break;
      }
    }
  }

  function chooseTFModel() {
    document.getElementById("model_file_label_caffe").style.display = "none";
    document.getElementById("model_file_label_tf").style.display = "inline";
    document.getElementById("proto_file_section").style.display = "none";
  }

  function chooseCaffeModel() {
    document.getElementById("model_file_label_caffe").style.display = "inline";
    document.getElementById("model_file_label_tf").style.display = "none";
    document.getElementById("proto_file_section").style.display = "block";
  }
</script>
</body>
</html>
